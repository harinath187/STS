<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Project Tasks</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
</head>
<body class="bg-light">

<div class="container mt-4">
    <h1 class="mb-4 text-center">Project Tasks</h1>
    <form method="get" action="{{ url_for('task_bp.list_tasks') }}" class="mb-3">
        <div class="row g-2 align-items-center">
            <div class="col-auto">
                <label for="project_id" class="form-label fw-bold">Select Project:</label>
            </div>
            <div class="col-auto">
                <select id="project_id" name="project_id" class="form-select" onchange="this.form.submit()">
                    <option value="">-- Select Project --</option>
                    {% for project in projects %}
                        <option value="{{ project.id }}" 
                            {% if project.id|string == (selected_project_id|string) %}selected{% endif %}>
                            {{ project.project_name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </form>
   
    {% if tasks|length > 0 %}
<div class="text mb-3">
    <span class="fw-bold">Project Manager:</span> 
    <span class="text-primary">{{ tasks[0].manager_name or "Not Assigned" }}</span>
</div>
{% endif %}

    <div class="mb-3 text-end">
        <a href="{{ url_for('task_bp.add_task') }}" class="btn btn-success">Create New Task</a>
    </div>
    <div class="card shadow-sm p-3">
        <table id="tasksTable" class="table table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Task Name</th>
                    <th>Description</th>
                    <th>Employee</th>
                    <th>Estimated Hours</th>
                    <th>Worked Hours</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for task in tasks %}
                <tr>
                    <td>{{ task.task_name }}</td>
                    <td>{{ task.task_description or "No description" }}</td>
                    <td>{{ task.employee_name }}</td>
                    <!-- <td>{{ task.employee_name if task.employee_name else "Not Assigned" }}</td> -->

                    <!-- <td>{{ task.estimated_hrs }}</td>
                    <td>{{ task.worked_hrs }}</td>
                    <td>
                        {% set status = task.status|lower %}
                        <span class="badge 
                            {% if status == 'completed' %}bg-success
                            {% elif status == 'in progress' %}bg-warning text-dark
                            {% else %}bg-secondary{% endif %}">
                            {{ task.status }}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary view-details"
                            data-project="{{ task.project_name }}"
                            data-manager="{{ task.manager_name }}"
                            data-comments="{{ task.manager_comments or 'No comments' }}"
                            data-start="{{ task.start_date }}"
                            data-end="{{ task.end_date }}"
                            data-status="{{ task.status }}">
                            View Details
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

       
    </div> 
</div>
<div class="modal fade" id="taskDetailsModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content shadow-lg">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title">Project Details</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="card p-3 shadow-sm">
            <p><strong>Project Name:</strong> <span id="detailProject"></span></p>
            <p><strong>Manager:</strong> <span id="detailManager"></span></p>
            <p><strong>Manager Comments:</strong> <span id="detailComments"></span></p>
            <p><strong>Start Date:</strong> <span id="detailStart"></span></p>
            <p><strong>End Date:</strong> <span id="detailEnd"></span></p>
            <p><strong>Status:</strong> <span id="detailStatus"></span></p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
$(document).ready(function () {
    $('#tasksTable').DataTable({
        pageLength: 5,
        lengthMenu: [5, 10, 20, 50],
        ordering: true,
        searching: true
    });

   
    $(".view-details").click(function() {
        $("#detailProject").text($(this).data("project"));
        $("#detailManager").text($(this).data("manager"));
        $("#detailComments").text($(this).data("comments"));
        $("#detailStart").text($(this).data("start"));
        $("#detailEnd").text($(this).data("end"));
        $("#detailStatus").text($(this).data("status"));
        $("#taskDetailsModal").modal("show");
    });
});
</script>

</body>
</html> --> -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Project Tasks</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
</head>
<body class="bg-light">

<div class="container mt-4">
    <h1 class="mb-4 text-center">Project Tasks</h1>

    <!-- Project Selection -->
    <form method="get" action="{{ url_for('task_bp.list_tasks') }}" class="mb-3">
        <div class="row g-2 align-items-center">
            <div class="col-auto">
                <label for="project_id" class="form-label fw-bold">Select Project:</label>
            </div>
            <div class="col-auto">
                <select id="project_id" name="project_id" class="form-select" onchange="this.form.submit()">
                    <option value="">-- Select Project --</option>
                    {% for project in projects %}
                        <option value="{{ project.id }}" 
                            {% if project.id|string == (selected_project_id|string) %}selected{% endif %}>
                            {{ project.project_name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </form>

    {% if tasks|length > 0 %}
    <div class="text mb-3">
        <span class="fw-bold">Project Manager:</span> 
        <span class="text-primary">{{ tasks[0].manager_name or "Not Assigned" }}</span>
    </div>
    {% endif %}

    <div class="mb-3 text-end">
        <a href="{{ url_for('task_bp.add_task') }}" class="btn btn-success">Create New Task</a>
    </div>

    <!-- Tasks Table -->
    <div class="card shadow-sm p-3">
        <table id="tasksTable" class="table table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Task Name</th>
                    <th>Description</th>
                    <th>Employee</th>
                    <th>Estimated Hours</th>
                    <th>Worked Hours</th>
                    <th>Status</th>
                    <th>Comments</th>
                    
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for task in tasks %}
                <tr>
                    <td>{{ task.task_name }}</td>
                    <td>{{ task.task_description or "No description" }}</td>
                    <td>{{ task.employee_name or "Not Assigned" }}</td>
                    <td>{{ task.estimated_hrs }}</td>
                    <td>{{ task.worked_hrs }}</td>
                    <td>
                        {% set status = task.status|lower %}
                        <span class="badge 
                            {% if status == 'completed' %}bg-success
                            {% elif status == 'in progress' %}bg-warning text-dark
                            {% else %}bg-secondary{% endif %}">
                            {{ task.status }}
                        </span>
                    </td>
                    <td>{{ task.manager_comments or "No Comments" }}</td>
                    <!-- <td>
                        {% if task.attachment %}
                            <a href="{{ url_for('static', filename=task.attachment) }}" target="_blank">
                                {% if task.attachment.endswith(('.jpg','.jpeg','.png','.gif')) %}
                                    <img src="{{ url_for('static', filename=task.attachment) }}" width="50">
                                {% else %}
                                    View File
                                {% endif %}
                            </a>
                        {% else %}
                            No Attachment
                        {% endif %}
                    </td> -->
                    <td>
                        <button class="btn btn-sm btn-primary view-details"
                            data-project="{{ task.project_name }}"
                            data-manager="{{ task.manager_name }}"
                            data-employee="{{ task.employee_name }}"
                            data-comments="{{ task.manager_comments or 'No comments' }}"
                            data-attachment="{{ task.attachment }}"
                            data-start="{{ task.Start_Date }}"
                            data-end="{{ task.End_Date }}"
                            data-status="{{ task.status }}">
                            View Details
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div> 
</div>

<!-- Modal -->
<div class="modal fade" id="taskDetailsModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content shadow-lg">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title">Task Details</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="card p-3 shadow-sm">
            <p><strong>Project Name:</strong> <span id="detailProject"></span></p>
            <p><strong>Project Manager:</strong> <span id="detailManager"></span></p>
            <p><strong>Assigned Employee:</strong> <span id="detailEmployee"></span></p>
            <p><strong>Manager Comments:</strong> <span id="detailComments"></span></p>
            <p><strong>Attachment:</strong> <span id="detailAttachment"></span></p>
            <p><strong>Start Date:</strong> <span id="detailStart"></span></p>
            <p><strong>End Date:</strong> <span id="detailEnd"></span></p>
            <p><strong>Status:</strong> <span id="detailStatus"></span></p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
$(document).ready(function () {
    $('#tasksTable').DataTable({
        pageLength: 5,
        lengthMenu: [5, 10, 20, 50],
        ordering: true,
        searching: true
    });

    $(".view-details").click(function() {
        $("#detailProject").text($(this).data("project"));
        $("#detailManager").text($(this).data("manager"));
        $("#detailEmployee").text($(this).data("employee"));
        $("#detailComments").text($(this).data("comments"));
        $("#detailStart").text($(this).data("start"));
        $("#detailEnd").text($(this).data("end"));
        $("#detailStatus").text($(this).data("status"));

        const attachment = $(this).data("attachment");
        if(attachment){
            if(/\.(jpg|jpeg|png|gif)$/i.test(attachment)){
                $("#detailAttachment").html(`<img src="/static/${attachment}" width="100">`);
            } else {
                $("#detailAttachment").html(`<a href="/static/${attachment}" target="_blank">View File</a>`);
            }
        } else {
            $("#detailAttachment").text("No Attachment");
        }

        $("#taskDetailsModal").modal("show");
    });
});
</script>

</body>
</html>
